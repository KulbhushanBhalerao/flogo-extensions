{
  "imports": [
    "github.com/project-flogo/flow",
    "github.com/project-flogo/contrib/activity/noop",
    "github.com/kulbhushanbhalerao/flogo-extensions/prometheus-metrics",
    "github.com/tibco/flogo-general/src/app/General/activity/log",
    "github.com/tibco/flogo-general/src/app/General/trigger/timer"
  ],
  "name": "flogo-prometheus-metrics-activity",
  "description": "",
  "version": "1.0.0",
  "type": "flogo:app",
  "appModel": "1.1.1",
  "tags": [],
  "triggers": [
    {
      "ref": "#timer",
      "name": "tibco-wi-timer",
      "description": "Simple Timer trigger",
      "settings": {},
      "id": "TimerTrigger",
      "handlers": [
        {
          "description": "",
          "settings": {
            "Scheduler Options": "Timer",
            "Start Time": "",
            "Repeating": false,
            "Delayed Start": false,
            "Time Interval": 1,
            "Interval Unit": "Second",
            "Cron Expression": "CRON_TZ=Europe/Amsterdam * * * * *"
          },
          "action": {
            "ref": "github.com/project-flogo/flow",
            "settings": {
              "flowURI": "res://flow:New_flow"
            }
          },
          "name": "New_flow"
        }
      ]
    }
  ],
  "resources": [
    {
      "id": "flow:New_flow",
      "data": {
        "name": "New_flow",
        "description": "",
        "links": [
          {
            "id": 1,
            "from": "StartActivity",
            "to": "PrometheusMetricsConverter",
            "type": "label",
            "label": "StartActivity to PrometheusMetricsConverter"
          },
          {
            "id": 2,
            "from": "PrometheusMetricsConverter",
            "to": "LogMessage",
            "type": "label",
            "label": "PrometheusMetricsConverter to LogMessage"
          }
        ],
        "tasks": [
          {
            "id": "StartActivity",
            "name": "StartActivity",
            "description": "NoOp Activity",
            "activity": {
              "ref": "#noop"
            }
          },
          {
            "id": "PrometheusMetricsConverter",
            "name": "PrometheusMetricsConverter",
            "description": "Converts JSON messages into Prometheus metric format with configurable metric types, labels, and timestamps.",
            "activity": {
              "ref": "#prometheus-metrics",
              "settings": {
                "metricType": "gauge",
                "metricName": "flogo_metric",
                "includeHelp": true,
                "includeType": true,
                "timestamp": false
              },
              "input": {
                "metricData": {
                  "mapping": {
                    "cpu_usage": 75,
                    "memory_usage": 68,
                    "disk_usage": 45,
                    "service": "web-server",
                    "environment": "production"
                  }
                }
              },
              "schemas": {
                "input": {
                  "metricData": {
                    "type": "json",
                    "value": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"cpu_usage\":{\"type\":\"number\"},\"memory_usage\":{\"type\":\"number\"},\"disk_usage\":{\"type\":\"number\"},\"service\":{\"type\":\"string\"},\"environment\":{\"type\":\"string\"}}}",
                    "fe_metadata": "{\n\"cpu_usage\": 75,\n\"memory_usage\": 68,\n\"disk_usage\": 45,\n\"service\": \"web-server\",\n\"environment\": \"production\"\n}\n\n"
                  }
                }
              },
              "feSchemaMap": {}
            }
          },
          {
            "id": "LogMessage",
            "name": "LogMessage",
            "description": "Simple Log Message Activity",
            "activity": {
              "ref": "#log",
              "input": {
                "Log Level": "INFO",
                "flowInfo": true,
                "message": "=$activity[PrometheusMetricsConverter].prometheusMetric",
                "logLevel": ""
              }
            }
          }
        ],
        "fe_metadata": "eyJTdGFydEFjdGl2aXR5Ijp7IngiOjEwMCwieSI6MTAwfSwiUHJvbWV0aGV1c01ldHJpY3NDb252ZXJ0ZXIiOnsieCI6MjM1LCJ5Ijo5OH0sIkxvZ01lc3NhZ2UiOnsieCI6NTM4LCJ5Ijo5NX19",
        "metadata": {
          "input": [],
          "output": [],
          "fe_metadata": {}
        }
      }
    }
  ],
  "properties": [
    {
      "name": "FLOGO_LOG_LEVEL",
      "type": "string",
      "value": "DEBUG"
    }
  ],
  "connections": {},
  "contrib": "W3sicmVmIjoiZ2l0aHViLmNvbS90aWJjby9mbG9nby1nZW5lcmFsL3NyYy9hcHAvR2VuZXJhbCIsImlkIjoiR2VuZXJhbCIsInZlcnNpb24iOiIxLjYuNSIsInRhZyI6IjEuNi41LWIwNCIsIm5hbWUiOiJHZW5lcmFsIiwiczNsb2NhdGlvbiI6IlRpYmNvL0dlbmVyYWwiLCJpc1VzZXJFeHRlbnNpb24iOmZhbHNlfSx7InJlZiI6ImdpdGh1Yi5jb20va3VsYmh1c2hhbmJoYWxlcmFvL2Zsb2dvLWV4dGVuc2lvbnMvcHJvbWV0aGV1cy1tZXRyaWNzIiwidmVyc2lvbiI6IjEuMC4wIiwidGFnIjoiMS4wLjAiLCJuYW1lIjoiUHJvbWV0aGV1c01ldHJpY3NDb252ZXJ0ZXIiLCJpZCI6InRpYmNvLXByb21ldGhldXMtbWV0cmljcyIsInMzbG9jYXRpb24iOiJ7VVNFUklEfS9EZWZhdWx0L2FjdGl2aXR5L3Byb21ldGhldXMtbWV0cmljcyIsImlzVXNlckV4dGVuc2lvbiI6dHJ1ZX1d",
  "metadata": {
    "endpoints": [],
    "flogoVersion": "2.25.5"
  }
}